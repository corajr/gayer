// Generated by BUCKLESCRIPT VERSION 4.0.3, PLEASE EDIT WITH CARE

import * as List from "bs-platform/lib/es6/list.js";
import * as $$Array from "bs-platform/lib/es6/array.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Card$Gayer from "./Card.bs.js";
import * as ReasonReact from "reason-react/src/ReasonReact.js";
import * as Js_primitive from "bs-platform/lib/es6/js_primitive.js";
import * as Dragula$Gayer from "./Dragula.bs.js";
import * as ReactDragula from "react-dragula";
import * as Belt_MapString from "bs-platform/lib/es6/belt_MapString.js";

var defaultState_000 = /* dragContainerRef : record */[/* contents */undefined];

var defaultState_001 = /* dragulaRef : record */[/* contents */undefined];

var defaultState = /* record */[
  defaultState_000,
  defaultState_001
];

var component = ReasonReact.reducerComponent("Container");

function make(cards, onMoveCard, onChangeLayer, onSetRef, _) {
  var dropFn = function (_, target, _$1, _$2) {
    if (target !== undefined) {
      var children = Js_primitive.valFromOption(target).childNodes;
      var ids = $$Array.map((function (elt) {
              return elt.id;
            }), children);
      var idToLayer = List.fold_left((function (acc, param) {
              return Belt_MapString.set(acc, param[/* id */0], param[/* layer */1]);
            }), Belt_MapString.empty, cards);
      var newLayers = $$Array.fold_left((function (acc, id) {
              var match = Belt_MapString.get(idToLayer, id);
              if (match !== undefined) {
                return /* :: */[
                        match,
                        acc
                      ];
              } else {
                return acc;
              }
            }), /* [] */0, ids);
      return Curry._1(onMoveCard, List.rev(newLayers));
    } else {
      return /* () */0;
    }
  };
  var dragulaDecorator = function (theRef, param) {
    var state = param[/* state */1];
    state[/* dragContainerRef */0][0] = (theRef == null) ? undefined : Js_primitive.some(theRef);
    var state$1 = state;
    var onUnmount = param[/* onUnmount */4];
    var match = state$1[/* dragulaRef */1][0];
    var match$1 = state$1[/* dragContainerRef */0][0];
    if (match !== undefined || match$1 === undefined) {
      return /* () */0;
    } else {
      var drake = ReactDragula(/* array */[Js_primitive.valFromOption(match$1)], {
            invalid: (function (_, handle) {
                if (handle.tagName === "BUTTON") {
                  return true;
                } else {
                  return handle.getAttribute("role") === "slider";
                }
              })
          });
      console.log(drake);
      Dragula$Gayer.onDrop(drake, dropFn);
      Curry._1(onUnmount, (function () {
              destroy(drake);
              return /* () */0;
            }));
      state$1[/* dragulaRef */1][0] = Js_primitive.some(drake);
      return /* () */0;
    }
  };
  return /* record */[
          /* debugName */component[/* debugName */0],
          /* reactClassInternal */component[/* reactClassInternal */1],
          /* handedOffState */component[/* handedOffState */2],
          /* willReceiveProps */component[/* willReceiveProps */3],
          /* didMount */component[/* didMount */4],
          /* didUpdate */component[/* didUpdate */5],
          /* willUnmount */component[/* willUnmount */6],
          /* willUpdate */component[/* willUpdate */7],
          /* shouldUpdate */component[/* shouldUpdate */8],
          /* render */(function (self) {
              return React.createElement("div", {
                          ref: Curry._1(self[/* handle */0], dragulaDecorator)
                        }, $$Array.of_list(List.map((function (card) {
                                    return ReasonReact.element(card[/* id */0], undefined, Card$Gayer.make(card[/* id */0], card[/* layer */1], onChangeLayer, (function (theRef) {
                                                      return Curry._2(onSetRef, card[/* layer */1], theRef);
                                                    }), /* array */[]));
                                  }), cards)));
            }),
          /* initialState */(function () {
              return defaultState;
            }),
          /* retainedProps */component[/* retainedProps */11],
          /* reducer */(function (_, _$1) {
              return /* NoUpdate */0;
            }),
          /* subscriptions */component[/* subscriptions */13],
          /* jsElementWrapped */component[/* jsElementWrapped */14]
        ];
}

var RList = 0;

export {
  RList ,
  defaultState ,
  component ,
  make ,
  
}
/* component Not a pure module */
